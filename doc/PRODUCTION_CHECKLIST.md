# Чеклист настройки для Production

## Обязательно (критично для безопасности)

### 1. JWT Секретные ключи
- [ ] Сгенерировать `JWT_SECRET` (openssl rand -base64 32)
- [ ] Сгенерировать `JWT_REFRESH_SECRET` (openssl rand -base64 32)
- [ ] Создать `.env` файл на сервере
- [ ] Добавить ключи в `.env`
- [ ] Проверить, что `.env` в `.gitignore`

**Файл:** [SETUP.md](./SETUP.md)

## Рекомендуется (для безопасности и производительности)

### 2. CORS настройка (если знаете домены фронтенда)

**Уже реализовано!** CORS настроен с поддержкой ограничения доменов через переменную окружения.

По умолчанию разрешены все домены (`*`). Если знаете домены фронтенда, ограничьте их:

В `.env`:
```bash
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```

Если переменная не указана, разрешены все домены (для разработки).

### 3. Путь к базе данных

Уже настроен автоматически, но проверьте:
- [ ] Файлы базы данных находятся в `public/db/` (или путь из `DB_PATH`)
- [ ] Права доступа: `chmod 644 public/db/*.json`
- [ ] Резервное копирование настроено (опционально)

### 4. Порт

Уже настроен через `.env`:
```bash
PORT=3001
```

Можно изменить, если нужно.

### 5. Nginx Reverse Proxy (рекомендуется)

Для работы через домен и HTTPS:

- [ ] Настроить Nginx как reverse proxy
- [ ] Настроить SSL сертификат (Let's Encrypt)

**Файл:** [DEPLOY.md](./DEPLOY.md) (раздел "Настройка Nginx")

## Уже реализовано

### 6. Rate Limiting (защита от DDoS)

**Уже реализовано!** Rate limiting настроен для защиты от DDoS атак.

**Настройки:**
- Общий лимит: 100 запросов за 15 минут (настраивается через `RATE_LIMIT_MAX`)
- Лимит авторизации: 5 попыток за 15 минут (настраивается через `AUTH_RATE_LIMIT_MAX`)

В `.env` (опционально):
```bash
RATE_LIMIT_MAX=100          # Максимум запросов за 15 минут
AUTH_RATE_LIMIT_MAX=5        # Максимум попыток авторизации за 15 минут
```

### 7. Валидация данных

**Уже реализовано!** Валидация входных данных реализована с помощью `zod`.

**Что валидируется:**
- Регистрация и вход (email, пароль)
- Создание и обновление навыков
- Создание и обновление категорий, подкатегорий, городов
- Обновление данных пользователя

Все ошибки валидации возвращаются с кодом 400 и детальным описанием проблем.

### 8. Логирование запросов

Можно добавить более детальное логирование (например, `morgan`).

### 9. Мониторинг

- [ ] Настроить PM2 мониторинг
- [ ] Настроить алерты (опционально)

## Минимальный чеклист для запуска

Для базового запуска достаточно:

1. **JWT секреты** - ОБЯЗАТЕЛЬНО!
2. **Путь к базе данных** - уже настроен автоматически
3. **Порт** - уже настроен (3001)
4. **Переменные окружения** - через `.env` файл

## Быстрая проверка перед запуском

```bash
# 1. Проверьте .env файл
cat .env | grep JWT

# 2. Проверьте путь к базе данных
ls -la /var/www/public/db/  # или public/db/

# 3. Проверьте, что файлы базы данных существуют
ls -la /var/www/public/db/*.json

# 4. Проверьте права доступа
chmod 644 /var/www/public/db/*.json

# 5. Перезапустите сервер
pm2 restart skillswap-api

# 6. Проверьте логи
pm2 logs skillswap-api --lines 20
```

## Пример полного .env файла

```bash
# JWT секреты (ОБЯЗАТЕЛЬНО измените!)
JWT_SECRET=ваш-сгенерированный-ключ-1
JWT_REFRESH_SECRET=ваш-сгенерированный-ключ-2

# Время жизни токенов
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=30d

# Порт
PORT=3001

# Окружение
NODE_ENV=production

# Публичный URL API (для генерации URL к загруженным файлам)
API_URL=http://XXX.XXX.XXX.XXX:3001

# CORS (опционально, если знаете домены)
# ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# Rate limiting (опционально)
# RATE_LIMIT_MAX=100          # Максимум запросов за 15 минут
# AUTH_RATE_LIMIT_MAX=5       # Максимум попыток авторизации за 15 минут
```

## Важно помнить

1. **Секреты** - самое важное! Без них API небезопасен
2. **База данных** - проверьте путь и права доступа
3. **Логи** - проверяйте логи после запуска
4. **Резервное копирование** - настройте бэкапы базы данных

## Итого

**Минимум для запуска:**
- JWT секреты в `.env`

**Рекомендуется:**
- CORS настройка (если знаете домены) - Уже реализовано
- Nginx + SSL
- Rate limiting - Уже реализовано
- Валидация данных - Уже реализовано

**Остальное уже настроено автоматически!**

